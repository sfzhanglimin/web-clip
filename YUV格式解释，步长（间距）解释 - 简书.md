# YUV格式解释，步长（间距）解释 - 简书
[YUV格式解释，步长（间距）解释 - 简书](https://www.jianshu.com/p/eace8c08b169) 

 [YUV格式解释，步长（间距）解释 - 简书](https://www.jianshu.com/p/eace8c08b169) 

 [YUV格式解释，步长（间距）解释 - 简书](https://www.jianshu.com/p/eace8c08b169) 

 YUV格式解释，步长（间距）解释 - 简书

[](/)

[登录](/sign_in)[注册](/sign_up)[写文章](/writer)

[首页](/)![](https://www.jianshu.com/bn-static/assets/web/banner/FFO3ZxfXwFx1TY.svg)
[下载APP](/apps?utm_medium=desktop&utm_source=navbar-apps)[会员](/vips)[IT技术](/techareas)

YUV格式解释，步长（间距）解释
================

[![](https://upload.jianshu.io/users/upload_avatars/5769979/4d3c38a7-27d7-403a-83d4-07bcc5ace7ef?imageMogr2/auto-orient/strip|imageView2/1/w/80/h/80/format/webp)
Leoeoo](/u/ab6850995a40)关注赞赏支持

YUV格式解释，步长（间距）解释
================

[![](https://upload.jianshu.io/users/upload_avatars/5769979/4d3c38a7-27d7-403a-83d4-07bcc5ace7ef?imageMogr2/auto-orient/strip|imageView2/1/w/96/h/96/format/webp)
](/u/ab6850995a40)

[Leoeoo](/u/ab6850995a40)关注IP属地: 北京

0.3862019.10.21 17:03:57字数 1,439阅读 5,010

参考文章：[一文读懂 YUV 的采样与格式](https://links.jianshu.com/go?to=https%3A%2F%2Fglumes.com%2Fpost%2Fffmpeg%2Funderstand-yuv-format%2F)  
参考文章：[https://blog.csdn.net/bjrxyz/article/details/52690661](https://links.jianshu.com/go?to=https%3A%2F%2Fblog.csdn.net%2Fbjrxyz%2Farticle%2Fdetails%2F52690661)  
YUV420主要格式：

*   YUV420P  
    ·YV12（排列为YVU）  
    ·YU12（排列为YUV）（又称为I420）
*   YUV420SP  
    ·NV12（排列为Y UV交替）（iOS使用格式）  
    ·NV21（排列为Y VU交替）（安卓使用格式）

##### stride解释

stride可以翻译为：跨距、步长  
stride指在内存中每行像素所占的空间。如下图所示，为了实现内存对齐，每行像素在内存中所占的空间并不是图像的宽度。

  

![](https://upload-images.jianshu.io/upload_images/5769979-6431eb93943eb324.png)

stride_width.png

##### 图像处理、显示中的行宽（linesize）、步长（stride）、间距（pitch）

在图像数据传输和显示的过程中有一个不常用的参数：间距。

###### 间距的名称：

它有很多的别名，在使用d3d显示的时候，它叫pitch；在用ffmpeg解码的时候，它叫linesize；  
在用ffmpeg转换格式的时候，它叫stride。这篇文章中统一以间距来表示。

###### 间距为什么出现：

这个参数看起来似乎没什么用，因为它的值和图像的宽度一样。但是那是大多数情况下，一旦遇到它和宽度不一样的时候，如果你不了解它的含义，那么程序肯定要出问题。可是为什么有时候它等于宽度，有时候又不等于呢？这就和它的含义有关了。

我们都知道现在计算机的cpu都是32位或者64位的cpu，他们一次最少读取4、8个字节，如果少于这些，反而要做一些额外的工作，会花更长的时间。所有会有一个概念叫做内存对齐，将结构体的长度设为4、8的倍数。

间距也是因为同样的理由出现的。因为图像的操作通常按行操作的，如果图像的所有数据都紧密排列，那么会发生非常多次的读取非对齐内存。会影响效率。而图像的处理本就是一个分秒必争的操作，所以为了性能的提高就引入了间距这个概念。

###### 间距的含义：

间距就是指图像中的一行图像数据所占的存储空间的长度，它是一个大于等于图像宽度的内存对齐的长度。这样每次以行为基准读取数据的时候就能内存对齐，虽然可能会有一点内存浪费，但是在内存充裕的今天已经无所谓了。

###### 间距的值：

所以如果图像的宽度如果是内存对齐长度的整数倍，那么间距就会等于宽度，而现在的cpu通常一次读取都是4个字节，而我们通常见到的分辨率都是4的整数倍，所以我们通常发现间距和图像的宽度一样（这里通常指rgb32格式或者以通道表示的yuv420p格式的y通道）。但是如果遇到一些少见的分辨率时间距和图像的宽度就不一样。  
还有一种情况是显卡，因为显卡是独立工作的，所以显卡可能和cpu的内存对齐位数是不同的，此时间距就可能和cpu上的有很大差别，例如NVIDA显卡（它的内存对齐位数超大），通常在用d3d显示的时候会用到间距。所以如果你的d3d显示程序在Intel的显卡上显示正常，而在NVIDA显卡上显示不正常，先不要怀疑显卡驱动，先看看你有没有正确处理间距的问题。

###### 间距的处理：

那么对于间距和宽度不同的时候要如何处理呢？在不同的情况下，处理不同，但是只要把握一个核心—内存对齐，就能理解。

1.在使用d3d做图像显示的时候，在获取显示内存空间的时候通常会获取到一个参数pitch，就是我们的间距。显卡每次都将pitch长度的数据当做一行。我们将图像数据复制过去得时候要一行一行复制，每次下一行数据的目的起始位置都是上一行的起始位置加上间距。如果是yv12这种通道表示的数据，u、v通道要相应的将行距除2。间距导致的空间内容可以不用置空。  
2.在ffmpeg解码的时候，解码后会获取到一个参数linesize，其实也是间距。从解码后的数据内存中将数据拷贝出来的时候，需要一行一行拷贝，每一行数据的起始位置都是上一行的起始位置加上间距，一行的真正的图像数据长度就是是图像宽度（通道类型要相应除倍数）。  
3.在用ffmpeg进行图像格式转换的时候，需要传入一个参数stride，其实也是间距。只不过这次不需要复杂的处理，只需要知道传入ffmpeg进行转换的图像数据使用的间距，然后传入就行，ffmpeg会自动根据这个值进行相应的处理。

最后编辑于 ：2022.03.10 16:07:40